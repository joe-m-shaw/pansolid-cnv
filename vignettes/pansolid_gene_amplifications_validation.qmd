---
title: "Validation of Detecting Somatic Gene Amplifications with the PanSolid CLC Pipeline"
format: 
  docx:
    reference-doc: DOC6283_template.docx
toc: true
toc-title: "Table of Contents"
---

# Authors\

Author: Joe Shaw

Project Lead(s): Joe Shaw, Elizabeth Sollars, Eleanor Baker, Helene Schlecht, George Burghel

Date:	`r Sys.Date()`\

Author contact: joseph.shaw2@mft.nhs.uk; joseph.shaw3@nhs.net\

# Acronyms\

ALK: 			Anaplastic lymphoma kinase

CTNNB1:		Catenin beta 1

CLC:			Acronym unknown. CLC Bio was acquired by Qiagen in 2013.	

CNV:			Copy Number Variant

EGFR:			Epidermal Growth Factor Receptor

ERBB2:			ERythroBlastic oncogene B 2

FFPE:			Formalin-Fixed Paraffin Embedded

FISH:			Fluorescent In-Situ Hybridisation

GLH:			Genomic Laboratory Hub

NGS:			Next Generation Sequencing

NICE:			National Institute for Health and Care Excellence

UMI: 			Unique Molecular Identifier

WGS:			Whole Genome Sequencing\

# Purpose\

The purpose of this document is to describe the validation of detection of somatic gene amplifications on the PanSolid v2 QIAseq panel using the PanSolid CLC pipeline at the North West Genomic Laboratory Hub (GLH).

# Introduction\

At the North West GLH, somatic variant testing is performed using the QIAseq methodology (Qiagen) (1) and Illumina next generation sequencing (NGS) using a large panel of QIAseq primer targets named “PanSolid”. The current PanSolid enrichment, referred to as PanSolidv2 (CDHS-48608Z-11752) contains 11,752 unique QIAseq targets. Sequencing data from the PanSolid enrichment is analysed with a pipeline built in the Qiagen CLC Genomic Workbench. Detection of single nucleotide variants and indels on PanSolid has previously been validated (DOC6024 Validation of QIASeq PanSolid Enrichment). Currently, copy number variants (CNVs) are analysed using a separate QIAseq “core” panel with a bespoke pipeline written in Python, with copy number amplifications reported for 4 genes: EGFR, ERBB2, AR and MET. The long-term aim is to move all CNV detection to the PanSolid panel and the CLC pipeline.\

The detection of ERBB2 gene amplifications was validated on the PanSolid enrichment in April 2024 (DOC6260: Validation of Detecting Somatic ERBB2 Amplifications with the PanSolid CLC Pipeline). ERBB2 amplifications were prioritised for validation due to service needs, and were validated by comparison with results from droplet digital PCR testing. The aim of this validation document is to validate additional amplification genes on the PanSolid workflow; these genes are specified by the National Genomic Test Directory.\

```{r}
#| label: packages-and-data
#| warning: FALSE
#| include: FALSE

library(tidyverse)
library(here)
library(patchwork)
library(janitor)

source(here("scripts/set_shared_drive_filepath.R"))

source(here("scripts/load_processed_validation_data.R"))

source(here("functions/gene_table_functions.R"))

source(here("functions/pansolid_excel_functions.R"))

source(here("functions/primer_functions.R"))

```

##	Somatic Gene Amplifications\

Gene amplification is a common mechanism in the development of cancer (2).  Additional gene copies can be present on extra-chromosomal DNA rather than their initial chromosomal loci (3), for example EGFR amplifications can be present on extrachromosomal DNA fragments referred to as “double minutes” (4). “Double minute” refers to a very small (“minute”) bodies of chromatin material with two arms (“double) which were originally visualised by chromosome staining (5).\

The number of additional gene copies can vary between genes and tumour types, ranging as high as hundreds of gene copies. There is no consistent accepted threshold of copy number to classify a gene as “amplified”, although many clinical trials use a threshold of 10 copies as an entry requirement.\

Gene amplifications can have clinical relevance for choice of treatment and predicting resistance to treatment, particularly amplifications of genes encoding tyrosine kinase membrane receptors. It is predicted that increasing the gene copy number increases the levels of translated protein, which maintains aberrant cell signalling even in the presence of tyrosine kinase inhibitors (TKIs) (6). Historically, gene amplifications were detected with fluorescence in-situ hybridisation (FISH) and immunohistochemistry (IHC), but next generation sequencing (NGS) methods are being increasingly used. The PanSolid enrichment includes 212 genes relevant to cancer. Of these, there are 9 genes which were selected as having amplifications with clinical relevance (@tbl-amplification-coordinates).\

```{r}
#| label: tbl-amplification-coordinates
#| tbl-cap: "Gene Coordinates"
#| warning: FALSE
#| echo: FALSE

primer_df <- read_csv(paste0(data_folder, 
                             "primers/QIAseq.CDHS-48608Z-11752.primers3 (Converted).csv")) |> 
  clean_names()

target_df <- read_csv(paste0(data_folder,
                             "bed_files/PanSolidv2_GRCh38_noalt_BED.csv")) |> 
  clean_names()

amp_genes <- load_pansolid_gene_table("Amplifications")

gene_tbl <- read_csv(file = paste0(data_folder, "gene_lists/gene_coordinates.csv"),
                       col_types = "ccccdd")

primer_df_mod <- extract_cnv_coordinates(df = primer_df, cnv_coord_col = region) |> 
  mutate(region_length = abs(start-end)) |> 
  rename(primer_start = start,
         primer_end = end)

gene_tbl_mod <- gene_tbl |> 
  mutate(gene_size_kb = round(abs(gene_start - gene_end) / 1000, 1)) |> 
  rowwise() |> 
  mutate(primers_in_gene = count_primers_in_region(chrom = chromosome,
                                                   coord1 = gene_start,
                                                   coord2 = gene_end,
                                                   df = primer_df_mod)) |> 
  filter(gene %in% amp_genes$gene) |> 
  arrange(gene)

gene_target_counts <- target_df |> 
  filter(name %in% amp_genes$gene) |> 
  count(name)

gene_coordinate_tbl <- gene_tbl_mod |> 
  mutate(grch38_coordinates = str_c("chr", chromosome, ":", gene_start, "-", gene_end)) |> 
  select(gene, grch38_coordinates, gene_size_kb, transcript_refseq,
         primers_in_gene) |> 
  left_join(gene_target_counts, 
            join_by("gene" == "name")) |> 
  rename(targets_in_gene = n)

knitr::kable(gene_coordinate_tbl)

```
\
```{r}
#| label: amplification-clinical-relevance
#| echo: FALSE


```

## Requirements

The requirements for this new method are as follows:\

- **Clinical utility:** the test should provide clear results for the 10 listed amplification markers.

- **Clinical validity:** the test should have a defined sensitivity and specificity for these markers, calculated by comparison with an orthogonal test.

- **Dosage accuracy:** it should be shown how accurate the test is at detecting amplifications of different copy number states, expressed as a correlation between the test and copy numbers from an orthogonal test.

- **Quality control:** the test should have clear quality control thresholds for deciding when the test results should be reported and when the test has failed.

- **Variability:** the test should have defined intra-run variation (repeatability) and inter-run variation (repeatability) for these amplifications.

- **Visualisation:** the results should be presented in a clear and visual manner.

- **Analysis:** there should be a clear procedure for analysis of copy number variants by laboratory staff.\

# Methodology

## Validation Structure

## Samples

Samples were received at the North West GLH between December 2019 and July 2024. Details of the normal control cohort used for the PanSolid CLC pipeline are given in the ERBB2 validation document (DOC6260). In total, 94 different samples were tested on the PanSolid version 2 enrichment during this validation.\

```{r}
#| label: tbl-tissue-types
#| tbl-cap: "Sample tissue types"
#| echo: FALSE

tissue_type_summary <- validation_sample_patient_info |> 
    filter(labno %in% validation_stdev_results_collated$labno) |> 
    mutate("Tissue type" = case_when(
      tissue_type == "Shavings" ~"FFPE shavings",
      tissue_type %in% c("Slides", "Positively-charged slides") ~"FFPE slides",
      TRUE ~tissue_type
    )) |> 
    count(`Tissue type`) |> 
    rename("Samples" = n) |> 
    arrange(desc(Samples)) |> 
    adorn_totals()

knitr::kable(tissue_type_summary)

```

```{r}
#| label: cancer-types-table
#| echo: FALSE

cancer_type_summary <- validation_sample_patient_info |> 
  filter(labno %in% validation_stdev_results_collated$labno) |> 
  #filter(cancer_type_new != "Reference material") |> 
  count(cancer_type_new) |> 
  rename("Samples" = n,
         "Cancer" = cancer_type_new) |> 
  arrange(desc(Samples)) |> 
  adorn_totals()

knitr::kable(cancer_type_summary)

```

```{r}
#| label: extraction-types-table
#| echo: FALSE

extraction_type_summary <- validation_sample_patient_info |> 
  filter(labno %in% validation_stdev_results_collated$labno) |> 
  count(method_name) |> 
  rename("DNA extraction method" = method_name,
         "Samples" = n) |> 
  arrange(desc(Samples)) |> 
  adorn_totals()

knitr::kable(cancer_type_summary)

```

```{r}
#| label: ncc-table
#| echo: FALSE

ncc_summary <- validation_sample_patient_info |> 
    filter(labno %in% validation_stdev_results_collated$labno) |> 
    filter(neoplastic_cell_content != "Reference material") |> 
    mutate(ncc_class = case_when(
      neoplastic_cell_content %in% c(">10", "10-20%") ~">10%",
      neoplastic_cell_content %in% c("20-50", "20-30%",
                                     ">20%", ">20", 
                                     "20") ~">20%",
      neoplastic_cell_content %in% c(">30%", ">30") ~">30%",
      neoplastic_cell_content %in% c("50-75") ~">50%",
      neoplastic_cell_content %in% c( ">75", "80") ~">75%",
      TRUE ~neoplastic_cell_content
    ),
    ncc_class = factor(ncc_class, levels = c(">75%",
                                             ">50%",
                                             ">30%",
                                             ">20%",
                                             ">10%",
                                             "No NCC provided"))) |> 
    count(ncc_class) |> 
    rename("Neoplastic cell content" = ncc_class,
           "Samples" = n) |> 
    adorn_totals()

knitr::kable(ncc_summary)

```

## Reference Materials\

### SeraCare reference materials\

Reference materials were ordered from the company SeraCare to act as positive controls for different gene amplifications. Each control consists of DNA extracted from an FFPE sample of a stable cell line, spiked with plasmid DNA for specific genes at different quantities. The amplified genes included in the SeraCare reference materials are shown in Table 7.\

The details of the SeraCare controls are shown in Table 8. Note that there were two tubes of both the Seraseq® TNA (DNA) WT Mix and the Seraseq® Solid Tumor CNV Mix, +12 copies mix.\

### Limit of detection DNA mixtures

A limit of detection experiment was performed using the Seraseq® Solid Tumor CNV Mix, +12 copies reference material, which represented DNA from tumour cells, and the Seraseq® TNA (DNA) WT Mix, which represented DNA from normal cells. The two reference materials were mixed together to mimic samples with neoplastic cell contents of 30%, 20%, 10% and 0%. The final volume of each DNA mixture was 20 µl and the total DNA concentration was 6 ng/µl, which is the standard input for the PanSolid NGS workflow. These DNA mixtures were made on worksheet WS144265 and run on the PanSolid version 2 NGS workflow on worksheet WS144291. This limit of detection experiment is different to the limit of detection experiment performed on the PanSolid version 1 workflow for the validation of ERBB2 amplifications (DOC6260).\

## Next generation sequencing\

DNA was extracted using the QIASymphony extraction method (DOC6251: QIAsymphony DNA FFPE Extraction Procedure) and tested on version 2 (CDHS-48608Z-11752) of the PanSolid QIAseq enrichment (DOC5925: QIAseq PanSolid DNA Panel NGS Library Preparation) with sequencing on an Illumina Novaseq. The NGS data described in this validation document comes from 32 worksheets performed between January 2024 and August 2024.\

## Bioinformatic analysis

The CLC pipeline, including details of the methodology and quality metrics, is described in the ERBB2 amplifications validation document (DOC6260). All amplification genes were analysed on the “coarse” setting, except for MYC. MYC has only 3 targets on the PanSolid enrichment, and preliminary work showed that the coarse setting could not identify MYC amplifications in positive controls. The “fine” setting was used specifically for MYC to account for the lower number of QIAseq targets. The version of the PanSolid CLC pipeline tested in this validation was PanSolid Workflow v2.2.

## Orthogonal testing\
### Droplet digital PCR for *ERBB2*, *MYC*, *MET*, *BRAF* and *EGFR*\

Amplification results for the ERBB2, MYC, MET, BRAF and EGFR genes were confirmed using droplet digital PCR (ddPCR). ddPCR assays were designed using the workflow for confirming constitutional CNVs, which involves a universal forward primer and a reference assay for the AP3B1 gene on chromosome 5 (DOC4304 CNV Confirmation Using Droplet Digital PCR). ddPCR was performed using a BioRad QX200 system with 5ng DNA input per well. Each assay was validated for use and then used to test DNA from clinical FFPE samples and SeraCare controls (Table 9). The results for the ERBB2 ddPCR were previously reported in DOC6260. Details of the primer and probe sequences, reaction mix (Table 19) and thermocycling conditions (Table 21) are given in the Appendix.\

### Whole genome sequencing\

Samples which had been tested using whole genome sequencing (WGS) were selected for this validation, which included samples from the Tessa Jowell BRAIN MATRIX Platform Study (NCT04274283) (13). WGS was performed on DNA extracted from fresh-frozen tissue by Illumina Laboratory Services at the Wellcome Trust Sanger Institute in Cambridge, as part of the NHS Genomics Medicine Service. Formalin-fixed paraffin-embedded (FFPE) tissue from the same tumour block as the fresh frozen tissue used for WGS was used as the sample source for PanSolid testing. Samples included in this validation were analysed by WGS between December 2022 to February 2024, using the “somatic variants and pertinent germline findings in cancer susceptibility genes” pipeline version 2.28 to version 3.6.2.\

## Validation analysis\

This validation document is written in Quarto using R (version 4.4.1) and is publicly available on [Github](https://github.com/joeshaw824/pansolid_cnv_validation).\

## Data locations\

All data analysed in this validation is saved here:\

{{< pagebreak >}}

# Results










